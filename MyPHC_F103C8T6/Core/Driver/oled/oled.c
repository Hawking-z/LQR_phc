#include "oled.h"

void Oled_Init(OLED *obj)
{
    OpenOled(0); //关闭显示
    // 基础设置
    SetContrast(255);  //设置对比度
    EntireDisplay(0);  //是否全点亮屏幕
    InverseDisplay(0); //是否像素翻转
    OpenChargePump(1); //开启电荷泵
    // 地址设置
    SetMemAddMode(2);       //页寻址
    SetpageStartAddPage(0); //初始页位置
    SetColStartAddPage(0);  //初始列位置
    //硬件设置
    SetStartLine(0);        //设置显示开始行
    SetSegmentRemap(0);     //设置segment重映射,改变屏幕数据列地址和段驱动器间的映射关系
    SetMultiplexRatio(63);  //设置分辨率
    SetScanDirection(0);    //是否垂直翻转
    SetDisplayOffset(0, 0); //设置偏移（默认）
    SetComPins(0, 1);       //设置引脚分配(默认)
    //显示时钟分频值和震荡频率（都为默认值）
    SetVcomLevel();
    SetClockDiv_OscFre();
    SetPreCharge();
    OpenOled(1);  //打开显示
    Oled_Clear(); //清屏
    memset(obj->num, 0, sizeof(obj->num));
    memset(obj->string, 0, sizeof(obj->string));
    obj->update1 = 1;
    obj->update2 = 1;
    obj->update3 = 1;
    obj->update4 = 1;
}

void Oled_Clear()
{
    for (uint8_t i = 0; i < WIDTH; i++)
    {
        SetpageStartAddPage(i);
        SetColStartAddPage(0);
        for (uint8_t j = 0; j < LENGTH; j++)
        {
            OLED_Write_Byte(DATA_ADD, 0);
        }
    }
}

void Oled_ClearPage(uint8_t page)
{
    SetpageStartAddPage(page);
    SetColStartAddPage(0);
    for (uint8_t j = 0; j < LENGTH; j++)
    {
        OLED_Write_Byte(DATA_ADD, 0);
    }
}

void Oled_ShowAll()
{
    for (uint8_t i = 0; i < WIDTH; i++)
    {
        SetpageStartAddPage(i);
        SetColStartAddPage(0);
        for (uint8_t j = 0; j < LENGTH; j++)
        {
            OLED_Write_Byte(DATA_ADD, 0xff);
        }
    }
}

void Oled_ShowPoint(uint8_t x, uint8_t y)
{
    uint8_t page = y / 8;
    uint8_t byte = 1 << (y % 8);
    SetpageStartAddPage(page);
    SetColStartAddPage(x);
    OLED_Write_Byte(DATA_ADD, byte);
}

void Oled_WriteON()
{
    OpenChargePump(1); //开启电荷泵
    OpenOled(1);       //打开显示
}

void Oled_WriteOFF()
{
    OpenChargePump(0); //关闭电荷泵
    OpenOled(0);       //关闭显示
}

void Oled_ShowChar(uint8_t x, uint8_t y, uint8_t height, uint8_t width, uint8_t *data)
{
    for (uint8_t i = 0; i < height; i++)
    {
        SetpageStartAddPage(y + i);
        SetColStartAddPage(x);
        for (uint8_t j = 0; j < width; j++)
        {
            OLED_Write_Byte(DATA_ADD, data[j + i * width]);
        }
    }
}

void Float2String(float fl, char *str, uint8_t d) // fl:浮点数    d:小数位数
{
    int integer = 0;   //整数部分
    float decimal = 0; //小数部分
    int temp;
    uint8_t i, n;
    //整数部分
    integer = (int)(fl);
    sprintf(str, "%d", integer);
    strcat(str, ".");
    n = strlen(str) - 1;
    //小数部分
    decimal = fabsf(fl - integer);
    for (i = n + 1; i < d + n + 1; i++)
    {
        decimal = decimal * 10;
        *(str + i) = (uint8_t)(decimal) + '0';
        decimal = decimal - (uint8_t)(decimal);
    }
    *(str + i) = '\0';
}

void String2Order(char *string, uint8_t len, uint8_t *data)
{
    for (uint8_t i = 0; i < len; i++)
    {
        if ('A' <= string[i] && string[i] <= 'Z')
            data[i] = (uint8_t)(string[i] - 'A');
        else if ('a' <= string[i] && string[i] <= 'z')
            data[i] = 26 + (uint8_t)(string[i] - 'a');
        else if ('0' <= string[i] && string[i] <= '9')
            data[i] = 52 + (uint8_t)(string[i] - '0');
        else
        {
            switch (string[i])
            {
            case '.':
                data[i] = 62;
                break;
            case ':':
                data[i] = 63;
                break;
            case ',':
                data[i] = 64;
                break;
            case ' ':
                data[i] = 65;
                break;
            case '-':
                data[i] = 66;
                break;
            case '%':
                data[i] = 67;
                break;
            default:
                break;
            }
        }
    }
    if (len <= 16)
    {
        for (uint8_t i = len; i < 16; i++)
        {
            data[i] = 65;
        }
    }
}

//全局变量
uint8_t MyCharacter[68][16] =
    {
        /*--------------------------------------------大写字母---------------------------------------------------*/
        0x04, 0x3C, 0xC4, 0x40, 0x40, 0xE4, 0x1C, 0x04, 0x00, 0x00, 0x03, 0x1C, 0x07, 0x00, 0x00, 0x00, /*"A",0*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x04, 0x04, 0x88, 0x70, 0x00, 0x10, 0x1F, 0x11, 0x11, 0x11, 0x0E, 0x00, 0x00, /*"B",1*/
        /* (8 X 16 , 宋体 )*/

        0xE0, 0x18, 0x04, 0x04, 0x04, 0x08, 0x10, 0x00, 0x03, 0x0C, 0x10, 0x10, 0x10, 0x10, 0x1C, 0x00, /*"C",2*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x04, 0x04, 0x08, 0xF0, 0x00, 0x10, 0x1F, 0x10, 0x10, 0x10, 0x08, 0x07, 0x00, /*"D",3*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x04, 0xC4, 0x04, 0x18, 0x00, 0x10, 0x1F, 0x11, 0x11, 0x17, 0x10, 0x08, 0x00, /*"E",4*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x10, 0x1F, 0x11, 0x11, 0x17, 0x10, 0x08, 0x00, /*"F",5*/
        /* (8 X 16 , 宋体 )*/

        0xE0, 0x18, 0x04, 0x04, 0x44, 0x78, 0x40, 0x00, 0x03, 0x0C, 0x10, 0x10, 0x10, 0x1C, 0x00, 0x00, /*"G",6*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x84, 0x80, 0x80, 0x84, 0xFC, 0x04, 0x10, 0x1F, 0x10, 0x00, 0x00, 0x10, 0x1F, 0x10, /*"H",7*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x04, 0x04, 0xFC, 0x04, 0x04, 0x00, 0x00, 0x00, 0x10, 0x10, 0x1F, 0x10, 0x10, 0x00, 0x00, /*"I",8*/
        /* (8 X 16 , 宋体 )*/

        0x03, 0x01, 0x01, 0x01, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x1F, 0x10, 0x10, 0x00, /*"J",9*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x80, 0x64, 0x1C, 0x04, 0x00, 0x10, 0x1F, 0x11, 0x03, 0x14, 0x18, 0x10, 0x00, /*"K",10*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x04, 0x04, 0x04, 0x0C, 0x00, 0x10, 0x1F, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, /*"L",11*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x80, 0x7C, 0x80, 0xFC, 0x04, 0x00, 0x10, 0x1F, 0x1F, 0x00, 0x1F, 0x1F, 0x10, 0x00, /*"M",12*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x00, 0xE0, 0x18, 0xFC, 0x00, 0x10, 0x1F, 0x0C, 0x03, 0x00, 0x10, 0x1F, 0x10, /*"N",13*/
        /* (8 X 16 , 宋体 )*/

        0xF0, 0x08, 0x04, 0x04, 0x04, 0x08, 0xF0, 0x00, 0x07, 0x08, 0x10, 0x10, 0x10, 0x08, 0x07, 0x00, /*"O",14*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x84, 0x80, 0x80, 0x80, 0x00, 0x00, 0x10, 0x1F, 0x10, 0x10, 0x10, 0x10, 0x0F, 0x00, /*"P",15*/
        /* (8 X 16 , 宋体 )*/

        0xF0, 0x08, 0x14, 0x14, 0x0C, 0x0A, 0xF2, 0x00, 0x07, 0x08, 0x10, 0x10, 0x10, 0x08, 0x07, 0x00, /*"Q",16*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x00, 0xC0, 0x30, 0x0C, 0x04, 0x10, 0x1F, 0x11, 0x11, 0x11, 0x11, 0x0E, 0x00, /*"R",17*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x1C, 0x04, 0x84, 0x84, 0x44, 0x38, 0x00, 0x00, 0x0E, 0x11, 0x10, 0x10, 0x10, 0x1C, 0x00, /*"S",18*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0x04, 0xFC, 0x04, 0x00, 0x00, 0x00, 0x18, 0x10, 0x10, 0x1F, 0x10, 0x10, 0x18, 0x00, /*"T",19*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xF8, 0x04, 0x04, 0x04, 0x04, 0xF8, 0x00, 0x10, 0x1F, 0x10, 0x00, 0x00, 0x10, 0x1F, 0x10, /*"U",20*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0xE0, 0x1C, 0x70, 0x80, 0x00, 0x00, 0x10, 0x1E, 0x11, 0x00, 0x00, 0x13, 0x1C, 0x10, /*"V",21*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xC0, 0x7C, 0x80, 0x7C, 0xC0, 0x00, 0x00, 0x10, 0x1F, 0x00, 0x1F, 0x00, 0x1F, 0x10, 0x00, /*"W",22*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0x0C, 0x34, 0xC0, 0xC0, 0x34, 0x0C, 0x04, 0x10, 0x18, 0x16, 0x01, 0x01, 0x16, 0x18, 0x10, /*"X",23*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0x04, 0xFC, 0x04, 0x00, 0x00, 0x00, 0x10, 0x1C, 0x13, 0x00, 0x13, 0x1C, 0x10, 0x00, /*"Y",24*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0x1C, 0x64, 0x84, 0x04, 0x04, 0x18, 0x00, 0x08, 0x10, 0x10, 0x10, 0x13, 0x1C, 0x10, 0x00, /*"Z",25*/
        /* (8 X 16 , 宋体 )*/

        /*--------------------------------------------小写字母---------------------------------------------------*/
        0x00, 0x98, 0x24, 0x24, 0x48, 0xFC, 0x04, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, /*"a",0*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xFC, 0x88, 0x04, 0x04, 0x88, 0x70, 0x00, 0x08, 0x0F, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, /*"b",1*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x70, 0x88, 0x04, 0x04, 0x04, 0x88, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, /*"c",2*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xF8, 0x04, 0x04, 0x04, 0x08, 0xFC, 0x04, 0x00, 0x00, 0x01, 0x01, 0x01, 0x09, 0x0F, 0x00, /*"d",3*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xF8, 0x24, 0x24, 0x24, 0x24, 0xE8, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, /*"e",4*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x04, 0x04, 0xFC, 0x04, 0x04, 0x00, 0x00, 0x00, 0x01, 0x01, 0x07, 0x09, 0x09, 0x04, 0x00, /*"f",5*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xD6, 0x29, 0x29, 0x29, 0xC9, 0x06, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, /*"g",6*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x84, 0x00, 0x00, 0x04, 0xFC, 0x04, 0x08, 0x0F, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, /*"h",7*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x04, 0x04, 0xFC, 0x04, 0x04, 0x00, 0x00, 0x00, 0x01, 0x19, 0x19, 0x00, 0x00, 0x00, 0x00, /*"i",8*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x03, 0x01, 0x01, 0x01, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x19, 0x19, 0x00, 0x00, /*"j",9*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x24, 0x60, 0x94, 0x0C, 0x04, 0x00, 0x08, 0x0F, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, /*"k",10*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x04, 0x04, 0xFC, 0x04, 0x04, 0x00, 0x00, 0x00, 0x08, 0x08, 0x1F, 0x00, 0x00, 0x00, 0x00, /*"l",11*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x04, 0x00, 0xFC, 0x04, 0x00, 0xFC, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, /*"m",12*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0xFC, 0x84, 0x00, 0x00, 0x04, 0xFC, 0x04, 0x01, 0x01, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, /*"n",13*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xF8, 0x04, 0x04, 0x04, 0x04, 0xF8, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, /*"o",14*/
        /* (8 X 16 , 宋体 )*/

        0x01, 0xFF, 0x89, 0x04, 0x04, 0x88, 0x70, 0x00, 0x01, 0x01, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, /*"p",15*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x70, 0x88, 0x04, 0x04, 0x89, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x01, 0x00, /*"q",16*/
        /* (8 X 16 , 宋体 )*/

        0x04, 0x04, 0xFC, 0x84, 0x04, 0x00, 0x80, 0x00, 0x01, 0x01, 0x01, 0x00, 0x01, 0x01, 0x01, 0x00, /*"r",17*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xCC, 0x24, 0x24, 0x24, 0x24, 0x98, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, /*"s",18*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0x00, 0xF8, 0x04, 0x04, 0x08, 0x00, 0x00, 0x01, 0x01, 0x07, 0x01, 0x01, 0x00, 0x00, /*"t",19*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xF8, 0x04, 0x04, 0x04, 0x08, 0xFC, 0x04, 0x01, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, /*"u",20*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xC0, 0x30, 0x0C, 0x30, 0xC0, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x01, 0x01, 0x01, 0x00, /*"v",21*/
        /* (8 X 16 , 宋体 )*/

        0x80, 0x70, 0x0C, 0x30, 0xE0, 0x1C, 0x60, 0x80, 0x01, 0x01, 0x00, 0x01, 0x01, 0x00, 0x01, 0x01, /*"w",22*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x04, 0x8C, 0x70, 0x74, 0x8C, 0x04, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x01, 0x01, 0x00, /*"x",23*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x81, 0x61, 0x1E, 0x18, 0x60, 0x80, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, 0x01, 0x01, 0x01, /*"y",24*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x84, 0x0C, 0x34, 0x44, 0x84, 0x0C, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, /*"z",25*/
        /* (8 X 16 , 宋体 )*/

        /*--------------------------------------------数字字母---------------------------------------------------*/
        0x00, 0xF0, 0x08, 0x04, 0x04, 0x08, 0xF0, 0x00, 0x00, 0x07, 0x08, 0x10, 0x10, 0x08, 0x07, 0x00, /*"0",0*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0x04, 0x04, 0xFC, 0x04, 0x04, 0x00, 0x00, 0x00, 0x08, 0x08, 0x1F, 0x00, 0x00, 0x00, /*"1",1*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x0C, 0x14, 0x24, 0x44, 0x84, 0x0C, 0x00, 0x00, 0x0E, 0x10, 0x10, 0x10, 0x10, 0x0F, 0x00, /*"2",2*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x18, 0x04, 0x84, 0x84, 0x44, 0x38, 0x00, 0x00, 0x0C, 0x10, 0x10, 0x10, 0x11, 0x0E, 0x00, /*"3",3*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x60, 0xA0, 0x24, 0x24, 0xFC, 0x24, 0x24, 0x00, 0x00, 0x01, 0x02, 0x0C, 0x1F, 0x00, 0x00, /*"4",4*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x98, 0x04, 0x04, 0x04, 0x88, 0x70, 0x00, 0x00, 0x1F, 0x11, 0x11, 0x11, 0x10, 0x10, 0x00, /*"5",5*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0xF0, 0x88, 0x04, 0x04, 0x04, 0xF8, 0x00, 0x00, 0x07, 0x08, 0x11, 0x11, 0x09, 0x00, 0x00, /*"6",6*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0x00, 0x7C, 0x80, 0x00, 0x00, 0x00, 0x00, 0x18, 0x10, 0x10, 0x11, 0x16, 0x18, 0x00, /*"7",7*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x38, 0x44, 0x84, 0x84, 0x44, 0x38, 0x00, 0x00, 0x0E, 0x11, 0x10, 0x10, 0x11, 0x0E, 0x00, /*"8",8*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x80, 0x48, 0x44, 0x44, 0x88, 0xF0, 0x00, 0x00, 0x0F, 0x10, 0x10, 0x10, 0x08, 0x07, 0x00, /*"9",9*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x0C, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*".",10*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0x00, 0x0C, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x00, 0x00, 0x00, /*":",0*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x09, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*",",0*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*" ",0*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*"-",0*/
        /* (8 X 16 , 宋体 )*/

        0x00, 0x8C, 0x30, 0xC0, 0x78, 0x84, 0x78, 0x00, 0x0F, 0x10, 0x0F, 0x01, 0x06, 0x18, 0x00, 0x00, /*"%",1*/
                                                                                                        /* (8 X 16 , 宋体 )*/
};